{% extends "Layout.html.twig"|UKMpath %}


{% block content %}
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

<div class="container-fluid ukm-bolge nop">
	<div class="div-radius"></div>
	<div class="background-space">
		
	</div>
</div>

<div class="container one-page-container">
	
	<div class="col-xs-12 login">
		<div class="ukm-card col-xs-12 one-page-page" page-id="0">
			<h2 class="title">Hei, {{user.getFirstName()}}!</h2>

			<div class="login register">
				<div class="tel-nr ukm-input login-input-style focus-style-js">
					<div class="info focused">
						<img class="tel-icon svg" src="/app/img/user.svg">
						<p class="text">Telefonnummer</p>
					</div>
					<input id="loginTelNr" disabled value="{{user.getTelNr()}}" class="tel-input focus-style-js-input" autocomplete="on" type="text" name="name">
				</div>

				<div class="tel-nr ukm-input login-input-style focus-style-js">
					<div class="info focused">
						<img class="tel-icon svg" src="/app/img/user.svg">
						<p class="text">Fornavn</p>
					</div>
					<input id="registeredFirstName" disabled value="{{user.getFirstName()}}" class="tel-input focus-style-js-input" autocomplete="on" type="text" name="name">
					<div class="show-hide">
						<button type="button" class="change-disabled-input mini-round-style">Rediger</button>
					</div>
				</div>
				<div id="registeredFirstNameError" class="info-feil not-visible">
					<p class="icon">!</p>
					<span class="text">Fornavn er ikke gyldig!</span>
				</div>

				<div class="tel-nr ukm-input login-input-style focus-style-js">
					<div class="info focused">
						<img class="tel-icon svg" src="/app/img/user.svg">
						<p class="text">Etternavn</p>
					</div>
					<input id="registeredLastName" disabled value="{{user.getLastName()}}" class="tel-input focus-style-js-input" autocomplete="on" type="text" name="surname">
					<div class="show-hide">
						<button type="button" class="change-disabled-input mini-round-style">Rediger</button>
					</div>
				</div>
				<div id="registeredLastNameError" class="info-feil not-visible">
					<p class="icon">!</p>
					<span class="text">Etternavn er ikke gyldig!</span>
				</div>
				
				<div>
				
				<div class="next-button">
					<button id="profileChangePassword" type="button" class="button ukm-button-primary left">
						<span class="text no-icon">Bytt passord</span>						
					</button>
				
					<button id="profileSaveChanges" type="button" disabled class="button ukm-button-primary right">
						<span class="text no-icon">Lagre endringer</span>
					</button>
				</div>
				
			</div>
			
			<!-- Logout button -->
			<div class="next-button">
				<a href="/logout.php" type="button" class="button ukm-button-primary">
					<span class="text">Logg ut</span>
					<img class="icon" src="/app/img/chevron.png">
				</a>
			</div>
		
		</div>
	</div>
	<!-- PAGE 2 - SMS Verification - forgot password -->
	<div class="ukm-card password col-xs-12 one-page-page" page-id="smsForgotPassword">
		{% include "Part/Sms.html.twig" with {'renderId': 'forgotPassword', 'nextPage': '-1', 'prevPage' : 'smsForgotPassword'} %}
	</div>

	<!-- new password -->
	<div class="ukm-card password col-xs-12 one-page-page" page-id="newPassword">
		{% include "Part/newPassword.html.twig" %}
	</div>

	<!-- SMS Forward -->
	<div class="ukm-card password col-xs-12 one-page-page" page-id="smsForward">
		{% include "Part/SMSForward.html.twig" with {'nextPage': '-1'} %}
	</div>

</div>

<script src="app/js/one-page.js"></script>
<script src="app/js/login-functions.js"></script>


<script>
	var onePage = new OnePage();
	var ukmAPI = new UkmAPI();

	$('#profileChangePassword').off('click').click(() => {
		startSmsVerification();
	});

	$('.change-disabled-input').click((e) => {
		$(e.currentTarget).detach();
		$('#profileSaveChanges').attr('disabled', false);
	});

	$('#profileSaveChanges').click(async () => {
		var validation = true;
		if(!verifyLength('#registeredFirstName', '#registeredFirstNameError', 2)) {
			validation = false;
		}
	
		if(!verifyLength('#registeredLastName', '#registeredLastNameError', 2)) {
			validation = false;
		}
		
		if(!validation) return;



		try{
			var data = await ukmAPI.masterCall(
				'POST',
				'change-profile-info.php',
				{
					'first_name' : $('#registeredFirstName').val(),
					'last_name' : $('#registeredLastName').val() 
				}
			);

			window.location = '/';

		}catch(e) {
			console.log(e.responseText);
		}

	});

	$('#registeredFirstName, #registeredLastName').keyup(() => {
		verifyLength('#registeredFirstName', '#registeredFirstNameError', 2);
		verifyLength('#registeredLastName', '#registeredLastNameError', 2);
	});

	
	

</script>	

{% endblock %}