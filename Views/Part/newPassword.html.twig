<h2 class="title">Bytt passord</h2>
<small class="under-title">Fyll inn nytt passord</small>

<div class="login">
	<div class="tel-nr ukm-input login-input-style focus-style-js">
		<div class="info">
			<img class="tel-icon" src="/app/img/lock.png">

			<p class="text">Nytt passord</p>
		</div>
		<input id="newPasswordInput" class="tel-input show-hide-input focus-style-js-input" type="password" name="password">
		<div class="show-hide">
			<button id="showHidePassword" type="button" class="show-hide-password mini-round-style">vis</button>
		</div>
	</div>
	<div id="newPasswordError">
		
	</div>


	{% if errorMessage and telNr %}
		<div id="wrongPassword" class="info-feil error">
			<p class="icon">!</p>
			<span class="text">{{errorMessage}}</span>
		</div>
	{% endif %}
</div>
<div id="loginPasswordError">
	
</div>

<div class="next-button">
	<button id="backTo" type="button" class="ukm-button-primary button half-color left render-page-click" to-page="0">
		<img class="icon" src="/app/img/chevron-back.png">
	</button>

	<button id="newPasswordButton" type="submit" name="login" class="ukm-button-primary button right">
		<span class="text">Send</span>
		<img class="icon" src="/app/img/chevron.png">
	</button>

	<button id="tryNewPasswordAgain" type="submit" name="login" class="hide ukm-button-primary button right">
		<span class="text">Pr√∏v igjen</span>
		<img class="icon" src="/app/img/chevron.png">
	</button>
</div>



<script>
	// Password validation
	$('#newPasswordInput').on('input', (e) => {
		validatePassword($(e.currentTarget).val(), $('#newPasswordError'));
	});

	$('#newPasswordButton').click(async () => {
		if(!validatePassword($('#newPasswordInput').val(), $('#newPasswordError'), true)) {
			return;
		}

		var result = await ukmAPI.masterCall(
			'POST',
			'finish-change-password.php',
			{
				'new_password' : $('#newPasswordInput').val()
			}
		)
	
		if(result.result == true) {
			window.location = '/';
		}
		else if(result.timeout) {
			addErrorMessage($('#newPasswordError'), result.msg, true);
			$('#newPasswordButton').addClass('hide');
			$('#tryNewPasswordAgain').removeClass('hide');
		}
		else {
			addErrorMessage($('#newPasswordError'), result.msg, true);
		}
	});

	$('#tryNewPasswordAgain').click(() => {
		$('#tryNewPasswordAgain').addClass('hide');
		$('#newPasswordButton').removeClass('hide');

		$('#newPasswordInput').val();
		$('#newPasswordError *').detach();
		startSmsVerification();
	});
</script>