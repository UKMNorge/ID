{% extends ("Layout.html.twig")|UKMpath %}

{% block content %}
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600&display=swap" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

<div class="container-fluid top-background nop">
	<div class="div-radius"></div>
	<div class="background-space">
		
	</div>
</div>

<div class="container one-page-container">

	<div class="col-xs-12 login">
		<form class="form-signin" role="form" action="/login-one-page.php" method="post">

		<!-- PAGE 0 -->	
			<div class="login-box-style col-xs-12 one-page-page" page-id="0">
				{% include "Part/Hello.html.twig" %}
			</div>

		<!-- PAGE 0 -->
			<div class="login-box-style password col-xs-12 one-page-page" page-id="1">
				{% include "Part/Passord.html.twig" %}
			</div>

		</form>
	</div>

<!-- PAGE 2 -->
	<div class="login-box-style password col-xs-12 one-page-page" page-id="2">
		<div class="progress-steps">
			<div class="progress-div">
				<div class="step active">
					<img class="icon" src="Images/correct-xs.png">
				</div>
				<div class="space"></div>
				<div class="step">
					<img class="icon" src="Images/correct-xs.png">
				</div>
			</div>
		</div>

		<h2 class="title">Du får snart en SMS!</h2>
		<small class="under-title">Skriv inn koden du får fra oss på telefonen din</small>

		<div class="login">
			<div class="input-chain">
				<div class="inputs">
					<input class="tel-input focus-style-js-input" type="text" maxlength="1">
					<input class="tel-input focus-style-js-input" type="text" maxlength="1">
					<input class="tel-input focus-style-js-input" type="text" maxlength="1">
					<button class="icon" type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
						<span>?</button>
					</button>
				</div>
			</div>

			{# <div class="buttons-div">
				<button id="sendNewPassword" type="button" class="send-new-password">Send nytt passord</button>
			</div> #}
		</div>

		<div class="login-message collapse" id="collapseExample">
			<p class="text">
				Vi har send deg en engangskode på SMS som må fylles in over for å lage bruker hos UKM. Dette er viktig siden vi sender ut informasjon om arrangementene våre på SMS og kan da være sikre på at du har mottat den informasjonen du har behov for.
			</p>
			<div class="icon">
				<p class="char">i</p>
			</div>
		</div>

		<div class="next-button">
			<button id="" type="button" class="login-button-style-1 button half-color left render-page-click" to-page="0">
				<img class="icon" src="Images/chevron-back.png">
			</button>

			<button id="loginSend" type="submit" name="login" class="login-button-style-1 button right">
				<span class="text">Logg Inn</span>
				<img class="icon" src="Images/chevron.png">
			</button>
		</div>
	</div>
	

</div>
<script src="Js/one-page.js"></script>

<script>
	var onePage = new OnePage();

	// Add focus on click of the field (div)
	$('.focus-style-js').click((e) => {
		$(e.currentTarget).children('.info').addClass('focused');
		$(e.currentTarget).children('.tel-input').focus();

	});
	// On blur remove the focus if input length is 0
	$('.focus-style-js-input').on('blur', (e) => {
		var el = $(e.currentTarget);
		if(el.val().length < 1) {
			el.parent().children('.info').removeClass('focused');
		}
	});

	// Login next, verifying tel nr
	$('#loginNext').click(() => {
		verifyTelNr();
	});

	// Login next, verifying tel nr
	$('#loginNext').click(() => {
		if(verifyTelNr()) {
			var tel_nr = $('#loginTelNr').val();

			$.ajax({			
				"url": "https://id.ukm.dev/api/user-exists.php",
				"method": "POST",
				"timeout": 0,
				"data": {
					"tel_nr": $('#loginTelNr').val()
				},
				success: (data) => {
					data = JSON.parse(data);
					if(data.result == true) {
						onePage.render(1);
					}
					else {
						showErrorMessage('Brukeren eksisterer ikke, vil du registrere deg?');
					}
                }
            });
			
		}
	});

	function showErrorMessage(msg) {
		$('#messageError').removeClass('hide');
		$('#messageError .text').html(msg);
	}

	$('.render-page-click').click((e) => {
		onePage.render($(e.currentTarget).attr('to-page'));
	});

	$("#loginTelNr").keyup(() => {
		var telNr = $('#loginTelNr').val();
		$('#telNrError').addClass('not-visible');
		if(telNr.length > 5) {
			verifyTelNr()
		}
	});

	// Returns true if the telnr is validated otherwise false
	var verifyTelNr = function() {
		var telNr = $('#loginTelNr').val();
		$('#telNrError').addClass('not-visible');

		// Check if the telNr contains numbers only
		if(isNaN(telNr)){
			$('#telNrError').removeClass('not-visible').children('.text').text(`Telefonnummeret er ikke gyldig`);
		}
		// Tel nr is not equals to 8, show error
		else if(telNr.length < 8) {
			$('#telNrError').removeClass('not-visible').children('.text').text(`Det mangler ${8 - telNr.length} tall i telefonnummeret`);
		}
		else if(telNr.length > 8) {
			$('#telNrError').removeClass('not-visible').children('.text').text(`Det er for mange tall i telefonnummeret`);
		}
		else {
			return true;
		}
		return false;
	}

	$('#showHidePassword').click(() => {
		if($('#loginPassword').attr('type') == 'password') {
			$('#loginPassword').attr('type', 'text');
			$('#showHidePassword').text('skjul');
		}
		else {
			$('#loginPassword').attr('type', 'password');
			$('#showHidePassword').text('vis');
		}
	});

	
	console.log(onePage);

</script>



{% endblock %}